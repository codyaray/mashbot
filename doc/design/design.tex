\documentclass{report}
\usepackage{fullpage}
\usepackage{graphicx}

\usepackage{tikz}
\usetikzlibrary{arrows,shadows} % for pgf-umlsd
\usepackage[underline=true,rounded corners=false]{pgf-umlsd}

\newcommand{\CRUDcreate}[2]{
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:#1 Controller}
    \newinst{model}{:#1 Model}
    \newinst{data}{:MySQL}
    
    \begin{call}{browser}{GET '#2s/new'}{controller}{}
      \begin{call}{controller}{new()}{model}{}
      \end{call}
    \end{call}
    \begin{call}{browser}{POST '#2s/new'}{controller}{}
      \begin{call}{controller}{save()}{model}{}
        \begin{callself}{model}{validate()}{}
        \end{callself}
        \begin{call}{model}{INSERT}{data}{}
        \end{call}             
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Create #1}
\end{figure}
  
}
\newcommand{\CRUDshow}[2]{
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:#1 Controller}
    \newinst{model}{:#1 Model}
    \newinst{data}{:MySQL}
    
    \begin{call}{browser}{GET '#2s/:id'}{controller}{}
      \begin{call}{controller}{find(:id)}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Show a #1}
\end{figure} 
 
}
\newcommand{\CRUDlist}[2]{

\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:#1 Controller}
    \newinst{model}{:#1 Model}
    \newinst{data}{:MySQL}
    
    \begin{call}{browser}{GET '#2s'}{controller}{}
      \begin{call}{controller}{find(:all)}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{List #1s}
\end{figure}
  
}
\newcommand{\CRUDupdate}[3]{
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:#1 Controller}
    \newinst{model}{:#1 Model}
    \newinst{data}{:MySQL}
    
    \begin{call}{browser}{GET '#2s/:id'}{controller}{}
      \begin{call}{controller}{find(:id)}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
      \end{call}
    \end{call}
    \begin{call}{browser}{PUT '#2s/:id'}{controller}{}
     \begin{call}{controller}{find(:id)}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
     \end{call}
     \begin{call}{controller}{update\_attributes(:#2)}{model}{} 
        \begin{callself}{model}{validate()}{}
        \end{callself}
        \begin{call}{model}{UPDATE}{data}{}
        \end{call}        
     \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{#3}
\end{figure}  
}
\newcommand{\CRUDdelete}[2]{
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:#1 Controller}
    \newinst{model}{:#1 Model}
    \newinst{data}{:MySQL}
    
    \begin{call}{browser}{DELETE '#2s/:id'}{controller}{}
      \begin{call}{controller}{find(:id)}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
      \end{call}
      \begin{call}{controller}{destroy()}{model}{}
        \begin{call}{model}{DELETE}{data}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Delete #1}
\end{figure}  
}
\newcommand{\CRUD}[2]{
\CRUDcreate{#1}{#2}
\CRUDshow{#1}{#2}
\CRUDlist{#1}{#2}
\CRUDupdate{#1}{#2}{Update a #1}
\CRUDdelete{#1}{#2}

}




\title{Software Design Description for Mashbot} 

\author{George D'Andrea \and Andrew Gall \and Josiah Kiehl \and
  Cody Ray \and Vito Salerno}
\date{\today}

\begin{document}

\begin{titlepage}
\maketitle
\end{titlepage}


\chapter*{Revision History}
\begin{tabular}{|p{2in}|l|l|l|}
  \hline
  \textbf{Name} & \textbf{Date} & \textbf{Reason for Changes} & \textbf{Version} \\
  \hline \hline
  George D'Andrea, Andrew Gall, Josiah Kiehl, Cody Ray, Vito
  Salerno & 17 January 2010 & Initial Version & 1.0 \\
  \hline
\end{tabular}

\clearpage
\tableofcontents
\clearpage

\chapter{Introduction}
\section{Purpose}
This document serves to expand upon the requirement into implementation details and technology choices.  This document should be referenced when specific features are being implemented.
\section{Scope}
This covers the general architecture of Mashbot, as well as the design decisions used to apply that architecture via various appropriate technologies, libraries and frameworks.
\section{Definitions, Acronyms,   and Abbreviations}
\begin{itemize}
\item MVC | Model View Controller
\item SASS | Syntactically Awesome Style Sheets
\item HAML | XHTML Abstraction Markup Language
\item XHTML | Extensible Hypertext Markup Language
\item CSS | Cascading Style Sheets
\item API | Application Programmming Interface
\end{itemize}
\section{Context Diagram}
\chapter{Architecture}
\section{Overview}
Generally, Mashbot will be implemented using a strict Model-View-Controller architecture.  This is augmented by the inclusion of the Presentation and Aggregation Platform, the purpose of which is to abstract the interaction with external service APIs from the application as a whole, thus allowing a pure MVC architecture to be implemented, increasing maintainability, extensibility and accessibility.
\section{Four-Tier Architecture}
\begin{itemize}
\item Data Layer / Model
\item Presentation Layer / View
\item Business Layer / Controller
\item Publishing and Aggregation Platform
\end{itemize}
\section{Service-Oriented Architecture}
Mashbot will be implemented as two distinct yet related services.  The Campaign Manager will handle the interaction between the user and the data the Campaign Manager is concerned with, where the Presentation and Aggregation Platform will handle the interaction between external service APIs and the Campaign Manager.
\section{Survey of Technologies Used}
\subsection{Campaign Manager}
\begin{itemize}
\item Presentation Layer
  \begin{itemize}
  \item HAML | HTML replacement markup language, for building web layout structure.
  \item SASS | CSS replacement stylesheets, for applying visual styles to the layout built in HAML.
  \item jQuery | JavaScript library which provides cross-browser compatibility as well as streamlined Ajax request handling.
  \item Google Chart API | Public service provided by Google which generates many different kinds of charts and graphs.
  \end{itemize}
\item Business Layer
  \begin{itemize}
  \item Ruby | Dynamic programming language.
  \item Rails | Web application framework written in Ruby which provides a concise Model-View-Controller architecture.
  \item Heroku | Rails engine which provides enhanced production deployment via Rails compilation, a fast readonly filesystem, and horizontal scaling.
  \end{itemize}
\item Data Layer
  \begin{itemize}
  \item ActiveRecord | Component of Rails which provides the Active Record pattern of data access, creating data model objects and relationships for interacting with resources in a database.
  \item MySQL | Fast and free relational database which plugs into Rails without effort.
  \end{itemize}
\end{itemize}
\subsection{Publishing and Aggregation Platform}
\begin{itemize}
\item TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO:TODO: Put tech stuff here.
\end{itemize}
\section{Presentation Layer Components}
\subsection{Campaign Views}
Campaigns are accessed via the Create and Manage tabs on the primary navigation tabs.  Create is for the Create view, Manage is for List, Show and Edit.
\begin{itemize}
\item Create | This is where users can create new campaigns.
  \includegraphics[width=\textwidth]{../mockups/create.png}
\item List | This is where users can view, update or delete existing campaigns. \\*
  \includegraphics[width=\textwidth]{../mockups/manage.png}
\item Show | This view is what is shown when the user wants to view an existing campaign via the Show view.  This is also where the Content pieces will be listed. \\*
  \includegraphics[width=\textwidth]{../mockups/manage-addcontent.png}
\item Edit | This is virtually the same view as Create, however this will be prepopulated with the existing content of the given Campaign.
\end{itemize}
\subsection{Content Views}
Content pieces are included inside Campaigns.  These views are accessible via the Show view of a Campaign for the corresponding Campaign id.
\begin{itemize}
\item Create | When on the Show view of a given campaign, the user can enter the Create view for Content.
\item Show | This is how the user previews the Content they have created.
\item Edit | This is virtually the same view as Create, however this will be prepopulated with the existing content of the given Content.
\end{itemize}
\subsection{Scheduling Views}
\begin{itemize}
  \item Primary Scheduling View |  consists of a list of Campaigns available to be scheduled (ie: they do not have existing start/stop dates) as well as already scheduled Campaigns placed properly on the calendar. \\*
  \includegraphics[width=\textwidth]{../mockups/schedule.png}
  \item Content Scheduling View | similar to the Primary Scheduling View, however the items available to be scheduled here are the individual content pieces of the Campaign.  This is accessed via selecting the Campaign from the calendar, or via the List Campaign or Show Campaign views. \\*
  \includegraphics[width=\textwidth]{../mockups/schedule-content.png}
\end{itemize}
\subsection{Explore View}
 Here the user will have several available ``Insight Views.''  These are dependent on which plugins exist in the Publishing and Aggregation Platform, however there will be some provided by the Campaign Manager alone.  These will provide charts that are layerable, such that multiple charts can be seen on the same graph. \\*
  \includegraphics[width=\textwidth]{../mockups/explore-twitter.png}
\begin{itemize}
\item Plugin Independent
  \begin{itemize}
  \item Clickthrough tracking | Any time a link is generated via Mashbot, it is given a special redirecting URL that will allow Mashbot to track how many times the link has been clicked.
  \item Rate of publishing | How often does the user tweet/blog/etc. This will most likely be used to correlate frequency with user engagement.
  \end{itemize}
\item Plugin Dependent
  \begin{itemize}
  \item Facebook Fan tracking | A line chart of how many fans the user's fan page has.
    \includegraphics[width=\textwidth]{../mockups/explore-facebook.png}
  \item Twitter Follower tracking | A line chart of the number of twitter followers the user's twitter account has.
  \item Number of times retweeted | A line chart of the number of times a tweet of the user's has been retweeted.
  \end{itemize}
\end{itemize}

\section{Business Layer Components}
\section{Session and Authentication}
\subsection{Log In}

\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:Controller}
    \newinst{model}{:User Model}
    \newinst{data}{:MySQL}
    \begin{call}{browser}{HTTP POST}{controller}{}
      \begin{call}{controller}{Authenticate()}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Log in to authenticate the user.}
\end{figure}
\subsection{Log Out}
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:Controller}
    \newinst{model}{:User Model}
    \newinst{data}{:MySQL}
    \begin{call}{browser}{HTTP POST}{controller}{}
      \begin{call}{controller}{log\_out}{model}{}
        \begin{call}{model}{UPDATE}{data}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{End authenticated session by logging out.}
\end{figure}
\subsection{OAuth}
\subsection{Openid}
\subsection{Session Handling}
\section{Data Layer Components}
\section{External Components}
\subsection{Publishing and Aggregation Targets}
\begin{itemize}
\item Twitter
\item Tumblr
\item Wordpress
\item TODO: etc.
\end{itemize}
\subsection{Email/SMTP Service}

\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{manager}{:Campaign Manager}
    \newinst{daemon}{:Delayed Job Daemon}
    \newinst{mailer}{:Mailer Worker}
    \newinst{mail}{:SMTP Server}
    \begin{call}{manager}{send\_later()}{daemon}{}
    \end{call}
    \begin{callself}{daemon}{act()}{}
        \begin{call}{daemon}{perform}{mailer}{}
          \begin{call}{mailer}{sendmail()}{mail}{}
          \end{call}
        \end{call}
    \end{callself}
  \end{sequencediagram}
  \caption{Send email (Requirements 3.1.1)}
\end{figure}

\chapter{Design Features}
\section{External Authentication via Openid}

\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:OAuth Controller}
    \newinst{model}{:Authentication Model}
    \newinst{data}{:MySQL}
    \newinst{external}{:External Authentication API}
    \begin{call}{browser}{HTTP POST}{controller}{}
      \begin{call}{controller}{Authenticate()}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Authentication via OAuth with stored token.}
\end{figure}
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:OAuth Controller}
    \newinst{model}{:Authentication Model}
    \newinst{data}{:MySQL}
    \newinst{external}{:External Authentication API}
    \begin{call}{browser}{HTTP POST}{controller}{}
      \begin{call}{controller}{Authenticate()}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
        \begin{call}{model}{Authenticate()}{external}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Authentication via OAuth without stored token.}
\end{figure}
\section{Create User Account}
This is a basic CRUD operation: Create User Account. \\*
\CRUDcreate{User Accout}{user}
\section{Update User Account}
This is a basic CRUD operation: Update User Account. \\*
\CRUDupdate{User Account}{user}{Update a User Account}
\section{Delete User Account}
This is a basic CRUD operation: Delete User Account. \\*
\CRUDdelete{User Account}{user}
\section{Create Campaign}
This is a basic CRUD operation: Create Campaign. \\*
\CRUDcreate{Campaign}{campaign}
\section{View Campaign}
This is a basic CRUD operation: View Campaign. \\*
\CRUDlist{Campaign}{campaign}
This is a Read operation, similar to the above, but for one Campaign. \\*
\CRUDshow{Campaign}{campaign}
\section{Update Campaign}
This is a basic CRUD operation: Update Campaign. \\*
\CRUDupdate{Campaign}{campaign}{Update a Campaign}
\section{Delete Campaign}
This is a basic CRUD operation: Delete Campaign. \\*
\CRUDdelete{Campaign}{campaign}
\section{Schedule Campaign}
This is a basic CRUD operation: Schedule Campaign. \\*
\CRUDupdate{Schedulable Unit}{schedulable\_unit}{Update scheduled time of Schdulable Unit}
\section{Create Content}
This is a basic CRUD operation: Create Content. \\*
\CRUDcreate{Content Unit}{content\_unit}
\section{View Content\_Unit}
This is a basic CRUD operation: View Content\_Unit. \\*
\CRUDlist{Content Unit}{content\_unit}
This is a Read operation, similar to the above, but for one Content Unit.  \\*
\CRUDshow{Content Unit}{content\_unit}
\section{Update Content\_Unit}
This is a basic CRUD operation: Update Content\_Unit. \\*
\CRUDupdate{Content Unit}{content\_unit}{Update content\_unit}
\section{Delete Content\_Unit}
This is a basic CRUD operation: Delete Content\_Unit. \\*
\CRUDdelete{Content Unit}{content\_unit}
\section{Schedule Content\_Unit}
In order to change the scheduled time of anything that is schedulable, the same process as an update is carried out. \\*
\CRUDupdate{Schedulable Unit}{schedulable\_unit}{Update scheduled time of a Schedulable Unit}

After content is scheduled, it can be picked up by the Scheduler, triggered via Cron.  Every 30 minutes, Cron will run the Scheduler, which will look in the database for active Campaigns.  Within those active campaigns, each piece of content will be checked to see if the go-live time is now or past.  If it's now or past, the scheduler calls the Publishing and Aggregation Platform with the content needed for a push to the given External Service.
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{cron}{:Cron}
    \newinst{scheduler}{:Scheduler}
    \newinst{worker}{:Worker}
    \newinst{data}{:Database}
    \begin{call}{cron}{cron trigger}{scheduler}{}
      \begin{callself}{scheduler}{anything\_to\_do?()}{}
        \begin{call}{scheduler}{SELECT}{data}{}
        \end{call}
      \end{callself}
      \begin{call}{scheduler}{perform()}{worker}{}
      \end{call}
    \end{call}
		\end{sequencediagram}
  \caption{Perform a scheduled action}
\end{figure}
\section{View Metrics and Statistics via Explore Panel}
\section{Lost User Name}
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:User Account Controller}
    \newinst{model}{:User Account Model}
    \newinst{data}{:MySQL}
    \begin{call}{browser}{HTTP POST}{controller}{}
      \begin{call}{controller}{find\_by\_email(email)}{model}{}
        \begin{call}{model}{SELECT}{data}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Retrieving a lost username by email id.}
\end{figure}
\section{Lost Password}
\begin{figure}
  \centering
  \begin{sequencediagram}
    \newthread{browser}{:Browser}
    \newinst{controller}{:User Account Controller}
    \newinst{model}{:User Account Model}
    \newinst{data}{:MySQL}
    \newinst{mailer}{:Mailer}
    \begin{call}{browser}{HTTP POST}{controller}{}
      \begin{call}{controller}{reset\_password()}{model}{}
        \begin{call}{model}{UPDATE}{data}{}
        \end{call}
        \begin{call}{model}{sendmail()}{mailer}{}
        \end{call}
      \end{call}
    \end{call}
  \end{sequencediagram}
  \caption{Retrieving a lost password. Refer to email figure for mailer actions.}
\end{figure}

\chapter{Publishing and Aggregation Platform}

	\section{API Design}

	\section{Server Design}

	\section{Plugin Design}
		\subsection{Content-Type Plugins}
		\subsection{Service Plugins}

\chapter{Database Design}
\section{Summary}
\subsection{Advantages of Design}
\begin{itemize}
\item Decoupled Publishing Platform
  \begin{itemize}
  \item Allows publishing capabilities to be extended without change to the Campaign Manager.
  \item Provides asychronous publishing so HTTP requests do not time out when pushing a large amount of content.
  \item Allows scheduled items to get fired off, even if the Campaign Manager is not fully running.
  \end{itemize}
\end{itemize}
\subsection{Disadvantages of Design}
\subsection{Design Rationale}
\section{A Requirements Traceability Matrix}
\subsection{Traceability by Requirement Numbers}
\subsection{Traceability by Design Component}

\end{document}


% LocalWords:  Mashbot
